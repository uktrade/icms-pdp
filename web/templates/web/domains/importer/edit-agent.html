{% extends "layout/sidebar.html" %}
{% import "forms/forms.html" as forms %}
{% import "forms/fields.html" as fields %}

{% block css %}
  {{ contact_form.media.css }}
  {{ super() }}
{% endblock %}

{% block context_header %}
  Editing Agent '{{ form.instance.display_name }}' for Importer '{{ object.display_name }}'
{% endblock %}

{% block sidebar %}
  {% include "partial/importer/sidebar.html" %}
{% endblock %}

{% block main_content %}

  <div class="info-box info-box-info">
    This importer is an agent of importer '{{ object.display_name }}'.
  </div>

  {% include "web/domains/importer/company_list.html" %}

  {% call forms.form(action='', method='post', csrf_input=csrf_input) -%}
    {% block fields %}
      {% for field in form %}
      {% with lookup = field.name in ['name', 'registered_number'] %}
        {{ fields.field(field, lookup=lookup) }}
      {% endwith %}
      {% endfor %}
    {% endblock %}

    <div class="container">
      <div class="row">
        <div class="three columns"></div>
        <div class="eight columns">
          <ul class="menu-out flow-across">
            <li>
              <button type="submit" name="action" value="save" class="primary-button button">Save</button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  {% endcall %}

  {% with
    offices = form.instance.offices.all(),
    office_archive_url_name = 'importer-office-archive',
    office_unarchive_url_name = 'importer-office-unarchive',
    office_edit_url_name = 'importer-office-edit' %}

    {% include "partial/offices/list.html" %}
  {% endwith %}

  {% if form.instance.is_organisation() %}
    {% with
      contact_add_url_name = 'importer-contact-add',
      contact_delete_url_name = 'importer-contact-delete' %}

      {% include "partial/contacts/contacts.html" %}
    {% endwith %}
  {% endif %}
{% endblock %}

{% block page_js %}
  {% include "partial/offices/formset-script.html" %}
  {% include "web/domains/importer/search-companies.html" %}

  {{ contact_form.media.js }}
  {{ super() }}
{% endblock %}
